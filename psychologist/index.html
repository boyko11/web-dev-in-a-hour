<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Psychologist</title>
        <script src="jquery-3.1.1.min.js"></script>
    </head>
    <body>
        <h1>Hello There, I am your friendly psychologist assistant.</h1>

        <section style="margin-left: 100px;">

            <h2>Here is a list of available psychologist</h2>

            <form name="select-pshychologist">
                <div id="psychologist-list">
                </div>
            </form>

        </section>

        <template id="psychologist-template">
            <div>
                <input type="radio" class="psycho-name" name="psycho-name" value=""/>
                <span class="psycho-name"></span>
                <ul>
                    <li>
                        <label>Experience:</label>
                        <span class="psycho-experience"></span>
                    </li>
                    <li>
                        <label>Rate:</label>
                        <span class="psycho-rate"></span>
                    </li>
                </ul>
            </div>
        </template>
        <script>
            $(document).ready(function() {

                //bind radio-button
                $('html').on('change', 'input[type=radio][name=psycho-name]', function() {
                   console.log('change event!');
                    var post_data = {};
                    post_data.id = $(this).val();
                    $.ajax({
                        url: "/psychologist/list.json",
                        type: "post",
                        data: post_data
                    }).done( function( data ) {
                        console.log("Successful Post!");
                    }).fail( function() {

                        alert('You messed up!');
                    });
                });

                console.log("Hey there, I will be calling the server to get a list of psychos here.");
                $.ajax({
                    url: "/psychologist/list.json"
                }).done( function( list_of_psychologists_from_server ) {

                    var psychologist_div_content = '';

                    list_of_psychologists_from_server.forEach( function( psychologist ) {

                        var psychologist_template = $($('template#psychologist-template').html());
                        psychologist_template.find('span.psycho-name').html( psychologist.name );
                        psychologist_template.find('input.psycho-name').val(psychologist.id);
                        psychologist_template.find('span.psycho-name').html(psychologist.name);
                        psychologist_template.find('span.psycho-experience').html( psychologist.years_of_experience );
                        psychologist_template.find('span.psycho-rate').html( psychologist.rate );
                        psychologist_div_content += psychologist_template.html();
                    });

                    $('div#psychologist-list').html( psychologist_div_content );

                }).fail( function() {

                    alert('You messed up!');
                });
            });
        </script>
    </body>
</html>